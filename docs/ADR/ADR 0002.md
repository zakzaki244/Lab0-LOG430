# ADR 0002 – Séparation des responsabilités (couches)

**Status:** accepted  

## Contexte  
Pour garantir la maintenabilité et la testabilité du code, il faut clairement séparer :  
1. la présentation (interface console),  
2. la logique métier (calculs, règles de gestion),  
3. la persistance (accès à la base de données).  

Sans cette séparation, on risque d’avoir du code spaghetti où la logique métier appelle directement la base, rendant les tests unitaires et futures évolutions complexes.

## Décision  
Nous adoptons l’architecture en quatre modules :  
1. **main.py** – Interface console : lit les commandes de l’utilisateur et affiche les résultats.  
2. **service.py** – Logique métier : orchestre les opérations (calcul du total, gestion d’erreur, etc.).  
3. **dao.py** – Data Access Object : réalise les opérations CRUD via SQLAlchemy.  
4. **models.py + db.py** – Définition des entités et configuration de la connexion à la BD.  

Chacun de ces modules est testé séparément :  
- Tests unitaires pour `service.py` avec injection d’un `dao` factice  
- Tests d’intégration minimalistes pour `dao.py` contre une base SQLite en mémoire  

## Conséquences  
**Positif :**  
- Code modulaire et facile à comprendre  
- Tests unitaires isolés pour la logique métier  
- Possibilité de remplacer la couche de persistance sans toucher la UI ni le service  

**Négatif :**  
- Quelques fichiers et abstractions en plus à maintenir  
- Apprentissage initiale pour comprendre le pattern DAO/Service  
